<html>
    
    <head>
        <script type="text/javascript"  src="/node_modules/gojs/release/go.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/Figures.js" charset="UTF-8"></script>



        <!--script type="text/javascript"  src="/node_modules/gojs/extensions/FishboneLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/ParallelLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/RadialLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/SerpentineLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/SpiralLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/TableLayout.js" charset="UTF-8"></script>
        <script type="text/javascript"  src="/node_modules/gojs/extensions/TreeMapLayout.js" charset="UTF-8"></script-->



        <script type="text/javascript"  src="resources-client.js" charset="UTF-8"></script>

        <script src="/node_modules/ag-grid-enterprise/dist/ag-grid-enterprise.min.js"></script>

        <!--link rel="stylesheet" href="/node_modules/ag-grid-community/dist/styles/ag-grid.css">
        <link rel="stylesheet" href="/node_modules/ag-grid-community/dist/styles/ag-theme-balham.css"-->
    </head>


    <div>
        <p style = "font-family:georgia,garamond,serif;font-size:20px;font-style:italic;" id=selectedRows>Archi Views Telecom Model</p>
        <p style = "font-family:georgia,garamond,serif;font-size:12px;font-style:italic;" id=selectedRows2>documentation</p>
    </div>

        <input type="text" id="filter-text-box" placeholder="Filter..." oninput="onFilterTextBoxChanged()"/>
        <button id="loadbutton" onclick="LoadDiagram()" disabled>Load Diagram</button>
    
        <form id="test">
            <label><input type="radio" name="test" value=0 checked> Lineal</label>
            <label><input type="radio" name="test" value=1> Orthogonal</label>
        </form>
    

        <form id="test2">
            <label><input type="radio" name="test2" value=0 checked> Normal</label>
            <label><input type="radio" name="test2" value=1> GridLayout</label>
            <label><input type="radio" name="test2" value=2> TreeLayout</label>
            <label><input type="radio" name="test2" value=3> ForceDirectedLayout</label>
            <label><input type="radio" name="test2" value=4> LayeredDigraphLayout</label>
            <label><input type="radio" name="test2" value=5> CircularLayout</label>
        </form>
            

    <div id="myGrid" style="height:150px; width:1500px; display: table-cell;" class="ag-theme-balham"></div>
         
    <div id="myDiagramDiv" style="height:550px; width:1500px; background-color: #DAE4E4;"></div>
    
    <script>
        //globals
        var diagram_route = document.getElementById("test");
        var diagram_layout = document.getElementById("test2");

    </script>


    <script >

        var $ = go.GraphObject.make;
        var myDiagram = $(go.Diagram, "myDiagramDiv",{ "undoManager.isEnabled": true });




        myDiagram.nodeTemplate = $(
            go.Node,
            
            
            new go.Binding("location", "loc", go.Point.parse),
            

            { click: function(e, node) {
                var diagram = node.diagram;
                diagram.startTransaction("highlight");
                diagram.clearHighlighteds();
                node.findLinksOutOf().each(function(l) { l.isHighlighted = true; });
                node.findLinksInto().each(function(l) { l.isHighlighted = true; });
                node.findNodesOutOf().each(function(n) { n.isHighlighted = true; });
                node.findNodesInto().each(function(n) { n.isHighlighted = true; });
                node.isHighlighted = true;
                diagram.commitTransaction("highlight");}
            },

            $(go.Shape, new go.Binding("figure", selectfig ),  { fromSpot: go.Spot.AllSides, toSpot: go.Spot.AllSides, portId: "" },

                new go.Binding("fill", selectstroke ),

                // the Shape.stroke color depends on whether Node.isHighlighted is true
                //new go.Binding("stroke", "isHighlighted", function(h) { return h ? "red" : "black"; }).ofObject(),
                new go.Binding("strokeWidth", "isHighlighted", function(h) { return h ? 3 : 1; }).ofObject(),
                new go.Binding("opacity", "isHighlighted", function(h) { return h ? 1 : 0.5; }).ofObject(),

               // { parameter1: 14, fill: "rgba(128,128,128,0.33)" },
                new go.Binding("desiredSize", "size", go.Size.parse).makeTwoWay(go.Size.stringify) ),
            $(go.TextBlock, new go.Binding("text", "name"), 
                new go.Binding("width",  function(node) { return parseInt(node.size.split(" ")[0]); }),
                new go.Binding("height",  function(node) { return parseInt(node.size.split(" ")[1]); }),
                //{ wrap: go.TextBlock.WrapDesiredSize,
                { textAlign: "center", verticalAlignment: go.Spot.Center, isMultiline: true } ),

            { toolTip: $("ToolTip", $(go.TextBlock, { margin: 4 }, new go.Binding("text", "element_class" )))}

            );

            

            
            


            myDiagram.linkTemplate = $(go.Link,

            { click: function(e, link) {
                var diagram = link.diagram;
                diagram.startTransaction("highlight");
                diagram.clearHighlighteds();
                link.isHighlighted = true;
                diagram.commitTransaction("highlight");}
            },

                                
                // routing: go.Link.Normal, Orthogonal, or AvoidsNodes.

                              //  { routing: go.Link.Orthogonal, corner: 50, curve: go.Link.JumpOver, adjusting: go.Link.End,
                              //  fromEndSegmentLength:5, toEndSegmentLength:5 , toShortLength:0,   reshapable: true, resegmentable: true},

                              new go.Binding("routing", function() 
                              {  if(diagram_route.elements["test"].value==0) return go.Link.Normal; else return go.Link.Orthogonal;} ),
                               { corner: 90, curve: go.Link.JumpOver, adjusting: go.Link.End },

                                        $(go.Shape, 
                                        //{ segmentIndex: 0, segmentFraction :0.1 },

                                          //  new go.Binding("stroke", "isHighlighted", function(h) { return h ? "red" : "black"; }).ofObject(),
                                            new go.Binding("strokeWidth", "isHighlighted", function(h) { return h ? 3 : 1; }).ofObject(),
                                            new go.Binding("opacity", "isHighlighted", function(h) { return h ? 0.5 : 0.3; }).ofObject()
                                         ),
                                        $(go.Shape, { toArrow: "Triangle" },
                                            new go.Binding("strokeWidth", "isHighlighted", function(h) { return h ? 3 : 1; }).ofObject(),
                                            new go.Binding("opacity", "isHighlighted", function(h) { return h ? 0.5 : 0.3; }).ofObject()
                                        ),
                                        $(go.TextBlock, new go.Binding("text", "rel_name"), {font: "10pt Courier New"},
                                        {  segmentOffset: new go.Point(0, -10), segmentOrientation: go.Link.OrientUpright, width: 100, isMultiline: true
                                        //    wrap: go.TextBlock.WrapDesiredSize, textAlign: "center",  verticalAlignment: go.Spot.Center, margin: 1
                                        },
                                            //new go.Binding("stroke", "isHighlighted", function(h) { return h ? "red" : "black"; }).ofObject(),
                                            //new go.Binding("font", "isHighlighted", function(h) { return h ? "11pt Courier New" : "9pt Courier New"; }).ofObject(),
                                            new go.Binding("strokeWidth", "isHighlighted", function(h) { return h ? 3 : 1; }).ofObject(),
                                            new go.Binding("opacity", "isHighlighted", function(h) { return h ? 1 : 0.2; }).ofObject()
                                        )
                                    );


             myDiagram.groupTemplate =   $(go.Group, "Vertical", 
                                        { selectionObjectName: "PH", locationObjectName: "PH", resizable: true, resizeObjectName: "PH" },


                                        $(go.TextBlock, 
                                       { font: "Bold 10pt Sans-Serif", width: 300, wrap: go.TextBlock.WrapFit }, new go.Binding("text", "name")),
                                        

                                        
                                        
                                        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                                        $(go.Shape, { name: "PH" }, 
                                            new go.Binding("desiredSize", "size", go.Size.parse).makeTwoWay(go.Size.stringify),
                                            new go.Binding("figure", selectfig ),
                                            new go.Binding("fill", selectstroke ),
                                            { toolTip: $("ToolTip", $(go.TextBlock, { margin: 4 }, new go.Binding("text", "element_class")))}
                                           )

                                    );

        myDiagram.click = function(e) {e.diagram.commit(function(d) { d.clearHighlighteds(); }, "no highlighteds");};

        function selectstroke(node) {

            var rta;
            
            switch(node.element_class) {
                case "ApplicationComponent":
                case "ApplicationInterface":
                case "ApplicationService":
                case "ImplementationEvent":
                case "Junction":
                    rta = "rgba(65, 218, 197 ,0.80)"; break;    // celeste

                case "WorkPackage":
                    rta = "rgba(240, 95, 128 ,0.80)"; break;    // rosa

                case null:
                    rta = "rgba(255, 255, 255, 0.5)"; break;    // blanco

                case "BusinessActor":
                case "BusinessInterface":
                case "BusinessProcess":
                case "BusinessObject":
                case "BusinessEvent":
                case "BusinessInteraction":
                    rta =  "rgba(255, 255, 100, 0.8)"; break;   // amarillo

                default:
                    rta = "rgba(128, 218, 65,0.50)"; break;     // verde
            }

            return rta;
            
        }

        function selectfig(node) { 

            var rta;
            switch(node.element_class) {
//                case "ApplicationComponent":
//                    rta = "Component"; break;
                case "ApplicationService":
                    rta = "PrimitiveToCall"; break;

                case "TechnologyService":
                    rta = "DividedEvent"; break;

                case "TechnologyFunction":
                    rta = "ExternalProcess"; break;

                case "ApplicationInterface":
                case "BusinessInterface":
                    rta = "TriangleRight"; break;

//              case "WorkPackage":
//                  rta = "RoundedRectangle"; break;

                case "ImplementationEvent":
                    rta = "DataStorage"; break;

                case "Junction":
                    rta = "Connector"; break;

                case null:
                    if (node.class == "DiagramModelNote") { rta = "Package"; break; }
//                    if (node.class == "DiagramModelGroup") { rta = "RoundedRectangle"; break; }

                case "ImplementationEvent":
                    rta = ""; break;

                case "BusinessActor":
                    rta = "BpmnTaskUser"; break;

                case "BusinessObject":
                    rta = "DividedProcess"; break;

                case "Node":
                    rta = "Cube2"; break;

                default:
                    rta = "RoundedRectangle"; break;
            }

            return rta;
        }

    </script>

    <script type="text/javascript" charset="utf-8">

        var selectedRowsString = '';
       
        var columnDefs = [
            {headerName: "id", field: "id", hide: true},
            {headerName: "folder", field: "folder", width: 120, rowGroup:true,  hide: true},
            {headerName: "name", field: "name", width: 90, resizable: true},
            {headerName: "documentation", field: "documentation", width: 110, resizable: true},
            {headerName: "viewpoint", field: "viewpoint", width: 200}
        ];

        const rowData = getSQL("/get?id=3");


        var gridOptions = {
            defaultColDef: {
                sortable: true,
                filter: true
            },
            rowData: rowData,
            columnDefs: columnDefs,
            animateRows: true,
            enableRangeSelection: true,
            rowSelection: 'single',
            onSelectionChanged: onSelectionChanged
        };

        var gridDiv = document.querySelector('#myGrid');
        new agGrid.Grid(gridDiv, gridOptions);

        function onFilterTextBoxChanged() {
            gridOptions.api.setQuickFilter(document.getElementById('filter-text-box').value);
        }

        function onSelectionChanged() {
            var selectedRows = gridOptions.api.getSelectedRows();

            selectedRows.forEach( function(selectedRow, index) {
                selectedRowsString = selectedRow.id;
                document.querySelector('#selectedRows').innerHTML = selectedRow.name;
                document.querySelector('#selectedRows2').innerHTML = selectedRow.documentation;
            });
            
            document.getElementById("loadbutton").disabled = false;

            
        }


    </script>

    <script type="text/javascript" charset="utf-8">
        function LoadDiagram(){
            document.getElementById("loadbutton").disabled = true;

        
            /*
                GridLayout
                TreeLayout
                ForceDirectedLayout
                LayeredDigraphLayout
                CircularLayout

                extensions
                -------------
                FishboneLayout.js
                ParallelLayout.js
                RadialLayout.js
                SerpentineLayout.js
                SpiralLayout.js
                TableLayout.js
                TreeMapLayout.js

            */


            switch(diagram_layout.elements["test2"].value) {
                case "0":
                    myDiagram.layout = new go.Layout(); break;
                case "1":
                    myDiagram.layout = new go.GridLayout(); break;
                case "2":
                    myDiagram.layout = new go.TreeLayout(); break;
                case "3":
                    myDiagram.layout = new go.ForceDirectedLayout(); break;
                case "4":
                    myDiagram.layout = new go.LayeredDigraphLayout(); break;
                case "5":
                    myDiagram.layout = new go.CircularLayout(); break;

                default: 

            }


            myDiagram.model = new go.GraphLinksModel(getSQL("/get?id=0&view=" + selectedRowsString), getSQL("/get?id=1&view=" + selectedRowsString));
            document.getElementById("loadbutton").disabled = false;
        }
    </script>

</html>
